---
title: "Modelling systematic effects and latent phenomena in point referenced data"
subtitle: ""
author: "Charlotte M. Jones-Todd <br> ![](img/twitter.svg)@cmjonestodd"
institute: "![](img/uoa.png){width=5%} University of Auckland"
date: ""
header-includes:
   - \usepackage{xcolor}
   - \usepackage{amsmath}
   - \usepackage{animate}
output:
  xaringan::moon_reader:
    css: ["src/default-theme.css"]
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "libs/macros.js"
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
--- 


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(message = FALSE,cache = TRUE, echo = FALSE, warning = FALSE, fig.align='center')
library(Manu)
## devtools::install_github("G-Thomson/Manu") ## NZ bird colour palettes
```

### What is a point pattern?

```{r, echo=FALSE,  out.width="30%"}
knitr::include_graphics("img/recaptcha.jpg")
```

---

### Counting dots?


```{r pps,fig.width=15,fig.height=5}
library(spatstat)
set.seed(4321)
locs <- cbind(runif(100),runif(100))
pp <- ppp(locs[,1], locs[,2])
win <- owin()
par(mfrow = c(1,3), mar = c(0,0,0,0))
## point pattern
plot(locs,axes = "F",pch = 20,xlab = "",ylab = "",xlim = c(0,1),ylim = c(0,1),col = "darkgrey")
plot(win,add = TRUE)
## quadrat count
plot(locs,axes = "F",pch = 20,xlab = "",ylab = "",xlim = c(0,1),ylim = c(0,1),col = "darkgrey")
plot(win,add = TRUE)
q <- quadratcount(pp,5,5)
plot(q,add = TRUE,cex = 1.5)
## quad count finer matrix
plot(locs,axes = "F",pch = 20,xlab = "",ylab = "",xlim = c(0,1),ylim = c(0,1),col = "darkgrey")
plot(win,add = TRUE)
q <- quadratcount(pp,10,10)
plot(q,add = TRUE,cex = 1.5)
```


---

### How low can you go?

.center[
```{r animation,  fig.show='animate', animation.hook='gifski'}
selected_colours <- get_pal("Kaka")[c(5,3,1)]
cols <- colorRampPalette(selected_colours)(12)
s <- seq(5,50,5)
for(i in 1:length(s)){
  q <- quadratcount(pp,s[i],s[i])
  image(q,axes = FALSE,col = cols)
}
```
]

---

### Continuous?

```{r cont, fig.width = 8, fig.height=8}
image(density(pp)$v,axes = FALSE,col = cols)
points(locs,pch = 20)
```

---

### SPDE

.center[
```{r spdefig.height=8,fig.width=8}
library(plotly)
n <- seq(-4,4,length.out = 10)
n <- rep(n, each = 10) 
z <- outer(X = n,Y = n,function(X,Y) sin(X)*cos(Y))
## smoother
n <- seq(-4,4,length.out = 100)
z2 <-  outer(X = n,Y = n,function(X,Y) sin(X)*cos(Y)) + 2

p <- plot_ly(showscale = FALSE) %>%
  add_surface(z = ~z, cmin = min(z), cmax = max(z), colorscale = list(c(0, 1), c("#A8B9CB", "#A7473A"))) %>%
  add_surface(z = ~z2, cmin = min(z2), cmax = max(z2),colorscale = list(c(0, 1), c("#A8B9CB", "#A7473A")), opacity = 0.98) %>%
layout(
    title = "",
    scene = list(
      xaxis = list(title = "",zeroline = FALSE,showline = FALSE,showticklabels = FALSE,showgrid= FALSE),
      yaxis = list(title = "",zeroline = FALSE,showline = FALSE,showticklabels = FALSE,showgrid= FALSE),
      zaxis = list(title = "",zeroline = FALSE,showline = FALSE,showticklabels = FALSE,showgrid= FALSE)
    )) %>% config(displayModeBar = FALSE)
p
```
]

---

### Mesh

```{r mesh,fig.height=8,fig.width=8}
library(INLA)
mesh <- inla.mesh.2d(loc = cbind(runif(100),runif(100)),max.edge = c(0.1,0.3),cutoff = 0.07)
image(z2,axes = FALSE,col = cols)
plot(mesh,main = "",add = TRUE)
points(mesh$loc,pch = 20)
```




---

### References

 + [**Jones-Todd, C. M.**, Caie, P., Illian, J. B., Stevenson, B. C., Savage, A., Harrison D, J., & Bown, J. (2019) Identifying prognostic structural features in tissue sections of colon cancer patients using point pattern analysis. *Statistics in Medicine*, 38 (8), 1421–1441.](https://onlinelibrary.wiley.com/doi/pdf/10.1002/sim.8046)
 
 + [**Jones-Todd, C. M.**, Swallow, B., Illian, J. B., & Toms, M. (2018) A spatio-temporal multi-species model of a semi-continuous response. *Journal of the Royal Statistical Society, Series C (Applied Statistics)*, 67 (3), 705–722.](https://rss.onlinelibrary.wiley.com/doi/full/10.1111/rssc.12250)

 + [Soranio-Redondo, A., **Jones-Todd, C. M.**, Bearhop, S., Hilton, G. M., Lock, L., Stanbury, A., Votier, S. C., & Illian, J. B. (2019) Understanding species distribution in dynamic populations: a new approach using spatio-temporal point process models. *Ecography*, 42 (6), 1092–1102.](https://onlinelibrary.wiley.com/doi/pdf/10.1111/ecog.03771)
 
 + [Python, A.,  Illian, J. B., **Jones-Todd, C. M.**, & Blàngiardo, M. A Bayesian approach to modelling subnational spatial dynamics of worldwide non-state terrorism, 2010–2016. (2019) *Journal of the Royal Statistical Society, Series  A (Statistics in Society)*, 182 (1), 323–344.](https://rss.onlinelibrary.wiley.com/doi/pdfdirect/10.1111/rssa.12384)
 
 + **Jones-Todd, C. M.**, Pirotta, E., Durban, J., Claridge, D., Baird, R., Falcone, E., Schorr, G., Watwood,S., & Thomas, L.  *(Under review after resubmission)* Continuous-time discrete-space models of marine mammal exposure to Navy sonar.

---

### Diolch am wrando 

```{r, eval = FALSE, echo = FALSE}
## linux <sudo apt-get install cowsay>
```

.pull-left[
.animate__animated.animate__bounceInDown[
```{r dragon, echo = FALSE,eval = TRUE, comment = ""}
system2("cowsay", args = "-f dragon 'Questions?'", stdout = TRUE)
```
]
]


.pull-right[
<br>
<br>
<br>
.center[`r icon::fa_twitter(colour = "#00ACEE")` @cmjonestodd]
<br>
.center[`r icon::fa_github()` @cmjt]
<br>
.center[<i class="fas fa-images"></i>  [cmjt.github.io/slides/points](https://cmjt.github.io/slides/points)]
]